@model TechZone.Application.DTOs.OrderDto
@{
    ViewData["Title"] = "Order Details";
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index">Orders</a></li>
        <li class="breadcrumb-item active">@Model.OrderNumber</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-receipt"></i> Order Details</h2>
    <span class="badge bg-@GetStatusColor(Model.Status) fs-5">@Model.Status</span>
</div>

<div class="row">
    <!-- Order Info -->
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Order Information</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Order Number:</strong> @Model.OrderNumber
                    </div>
                    <div class="col-md-6">
                        <strong>Order Date:</strong> @Model.OrderDate.ToString("dd MMMM yyyy, hh:mm tt")
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(Model.TrackingNumber))
                {
                    <div class="alert alert-info">
                        <strong>Tracking Number:</strong> @Model.TrackingNumber
                    </div>
                }
            </div>
        </div>

        <!-- Order Items -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Order Items</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th class="text-end">Qty</th>
                            <th class="text-end">Price</th>
                            <th class="text-end">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderItems)
                        {
                            <tr>
                                <td>@item.ProductName</td>
                                <td class="text-end">@item.Quantity</td>
                                <td class="text-end">₹@item.UnitPrice.ToString("N2")</td>
                                <td class="text-end">₹@item.TotalPrice.ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                            <td class="text-end">₹@Model.SubTotal.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td colspan="3" class="text-end"><strong>Shipping:</strong></td>
                            <td class="text-end">₹@Model.ShippingCost.ToString("N2")</td>
                        </tr>
                        <tr>
                            <td colspan="3" class="text-end"><strong>Tax:</strong></td>
                            <td class="text-end">₹@Model.Tax.ToString("N2")</td>
                        </tr>
                        <tr class="table-primary">
                            <td colspan="3" class="text-end"><h5 class="mb-0">Total:</h5></td>
                            <td class="text-end"><h5 class="mb-0">₹@Model.TotalAmount.ToString("N2")</h5></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Shipping Address</h5>
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>@Model.ShippingFirstName @Model.ShippingLastName</strong></p>
                <p class="mb-1">@Model.ShippingAddress</p>
                <p class="mb-1">@Model.ShippingCity, @Model.ShippingState @Model.ShippingZipCode</p>
                <p class="mb-1">@Model.ShippingCountry</p>
                <p class="mb-0"><strong>Email:</strong> @Model.ShippingEmail</p>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Update Status</h5>
            </div>
            <div class="card-body">
                <form asp-action="UpdateStatus" method="post">
                    <input type="hidden" name="orderId" value="@Model.Id" />
                    
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select name="status" class="form-select" required>
                            <option value="2">Confirmed</option>
                            <option value="3">Processing</option>
                            <option value="4">Shipped</option>
                            <option value="5">Delivered</option>
                            <option value="6">Cancelled</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Tracking Number</label>
                        <input type="text" name="trackingNumber" class="form-control" 
                               value="@Model.TrackingNumber" />
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-check-circle"></i> Update Status
                    </button>
                </form>
            </div>
        </div>

        @if (Model.Status != Domain.Enums.OrderStatus.Cancelled && 
             Model.Status != Domain.Enums.OrderStatus.Delivered)
        {
            <div class="card">
                <div class="card-body">
                    <form asp-action="Cancel" asp-route-id="@Model.Id" method="post"
                          onsubmit="return confirm('Cancel this order?')">
                        <button type="submit" class="btn btn-danger w-100">
                            <i class="bi bi-x-circle"></i> Cancel Order
                        </button>
                    </form>
                </div>
            </div>
        }
    </div>
</div>

@functions {
    string GetStatusColor(TechZone.Domain.Enums.OrderStatus status)
    {
        return status switch
        {
            TechZone.Domain.Enums.OrderStatus.Pending => "warning",
            TechZone.Domain.Enums.OrderStatus.Confirmed => "info",
            TechZone.Domain.Enums.OrderStatus.Processing => "info",
            TechZone.Domain.Enums.OrderStatus.Shipped => "primary",
            TechZone.Domain.Enums.OrderStatus.Delivered => "success",
            TechZone.Domain.Enums.OrderStatus.Cancelled => "danger",
            _ => "secondary"
        };
    }
}